"ggpubr",
"ggstatsplot",
"openintro",
"rstatix",
"DescTools",
"WRS2",
"metan",
"ggstastplot",
"openxlsx",
"readxl")
new.packages <- list.of.packages[!(list.of.packages %in%
installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
library(tidyverse) # manipulación y visualización de datos
library(ggpubr) # gráficos sencillos
library(ggstatsplot) # gráficos listos para publicar
library(openintro) # datos de ejemplo
library(rstatix) # pruebas P/NP y estadísticos con tuberías.
library(DescTools) # prueba robusta de Yuen
library(WRS2) # tamaño de efecto robustos
library(metan)
library(ggstatsplot)
library(openxlsx)
library(readxl)
library(tidyverse) # manipulación y visualización de datos
library(ggpubr) # gráficos sencillos
library(ggstatsplot) # gráficos listos para publicar
library(openintro) # datos de ejemplo
library(rstatix) # pruebas P/NP y estadísticos con tuberías.
library(DescTools) # prueba robusta de Yuen
library(WRS2) # tamaño de efecto robustos
library(metan)
library(ggstatsplot)
library(openxlsx)
library(readxl)
ggplot(data = BLUPs_anova, aes(x = Material, y = BLUP)) +
geom_boxplot(aes(fill = ENV), width = 0.8) + theme_bw()
install.packages("GGEBiplots")
##LOAD DATA##
library(readxl)
library(openxlsx)
library(metan)
library(ggstatsplot)
library(tidyverse)
library(GGEBiplots)
#GWAS Pea Panel INFO
{
Panel_info <- read_excel("C:/Users/Salva/Documents/GitHub/Genomic-Selection/Genomic Selection_SALVA/data/ListaPeaGWAS.xlsx",
sheet = "R",
col_types =
c("text", #GEN
"text", #Reference
"text", #Species
"text", #Name
"text", #Origen
"text", #Material
"text"))#Structure
}
#season 2018
{
R18_nc <- read_excel("C:/Users/Salva/Documents/GitHub/Genomic-Selection/Genomic Selection_SALVA/data/R18_19_20.xlsx",
sheet = "R18_nc",
col_types =
c("text", #ENV
"text", #REP
"text", #BLOCK
"numeric", #ROW
"text", #Specie
"text", #Material
"text", #Structure
"numeric", #GEN
"numeric", #GERM
"numeric", #DtF
"numeric", #DtP
"numeric", #GDD_F
"numeric", #GDD_P
"numeric", #biomass_pl
"numeric", #yield_pl
"numeric", #Asco
"numeric", #Rust
"numeric" #Oidio
))
R18_nc$ENV <- as.factor(R18_nc$ENV)
R18_nc$REP <- as.factor(R18_nc$REP)
R18_nc$BLOCK <- as.factor(R18_nc$BLOCK)
R18_nc$ROW <- as.factor(R18_nc$ROW)
R18_nc$Material <- as.factor(R18_nc$Material)
R18_nc$Species <- as.factor(R18_nc$Species)
R18_nc$Structure <- as.factor(R18_nc$Structure)
R18_nc$GEN <- as.factor(R18_nc$GEN)
}
#season 2019
{
R19_nc <- read_excel("C:/Users/Salva/Documents/GitHub/Genomic-Selection/Genomic Selection_SALVA/data/R18_19_20.xlsx",
sheet = "R19_nc",
col_types =
c("text", #ENV
"text", #REP
"text", #BLOCK
"numeric", #ROW
"text", #Specie
"text", #Material
"text", #Structure
"text", #GEN
"numeric", #GERM
"numeric", #GDD_FF
"numeric", #GDD_F
"numeric", #GDD_FP
"numeric", #GDD_P
"numeric", #GDD_M
"numeric", #Rust
"numeric", #Biom_pl_g
"numeric" #yield_pl_g
))
R19_nc$ENV <- as.factor(R19_nc$ENV)
R19_nc$REP <- as.factor(R19_nc$REP)
R19_nc$BLOCK <- as.factor(R19_nc$BLOCK)
R19_nc$ROW <- as.factor(R19_nc$ROW)
R19_nc$Material <- as.factor(R19_nc$Material)
R19_nc$Species <- as.factor(R19_nc$Species)
R19_nc$Structure <- as.factor(R19_nc$Structure)
R19_nc$GEN <- as.factor(R19_nc$GEN)
}
#season 2020
{
R20_nc <- #NoControls
read_excel("C:/Users/Salva/Documents/GitHub/Genomic-Selection/Genomic Selection_SALVA/data/R18_19_20.xlsx",
sheet = "R20_nc",
col_types =
c("text", #ENV
"text", #REP
"text", #BLOCK
"numeric", #ROW
"text", #Specie
"text", #Material
"text", #Structure
"text", #GEN
"numeric", #GERM
"numeric", #GDD_FF
"numeric", #GDD_F
"numeric", #GDD_FP
"numeric", #GDD_P
"numeric", #GDD_M
"numeric", #Rust
"numeric", #Asco
"numeric", #Oidio
"numeric", #Biom_pl_g
"numeric" #yield_pl_g
))
R20_nc$ENV <- as.factor(R20_nc$ENV)
R20_nc$REP <- as.factor(R20_nc$REP)
R20_nc$BLOCK <- as.factor(R20_nc$BLOCK)
R20_nc$ROW <- as.factor(R20_nc$ROW)
R20_nc$Material <- as.factor(R20_nc$Material)
R20_nc$Species <- as.factor(R20_nc$Species)
R20_nc$Structure <- as.factor(R20_nc$Structure)
R20_nc$GEN <- as.factor(R20_nc$GEN)
}
#Growth Chamber. Controlled conditions:
{
RCC_nc <- #NoControls
read_excel("C:/Users/Salva/Documents/GitHub/Rust-collection/data/Rust_controlled_condition.xlsx",
sheet = "CC_n",
col_types =
c("text", #REP
"text", #BLOCK
"text", #GEN
"numeric", #L_area
"numeric", #L_aphila (0 = NO aphila; 1 = SI aphila)
"numeric", #L_border (0 = Liso; 0,5 = Semi; 1 = dentado)
"numeric", #AUDPC_n
"numeric", #GPL50_n
"numeric", #IF_n
"numeric", #DS_n
"numeric" #IT_n
))
RCC_nc$REP <- as.factor(RCC_nc$REP)
RCC_nc$BLOCK <- as.factor(RCC_nc$BLOCK)
RCC_nc$GEN <- as.factor(RCC_nc$GEN)
}
#Three field Seasons together. Data from multi-environment trials
{
Rall_field <- #NoControls
read_excel("C:/Users/Salva/Documents/GitHub/Genomic-Selection/Genomic Selection_SALVA/data/R18_19_20.xlsx",
sheet = "R_all",
col_types =
c("text", #ENV
"text", #REP
"text", #BLOCK
"numeric", #ROW
"text", #Specie
"text", #Material
"text", #Structure
"text", #GEN
"numeric", #GERM
"numeric", #GDD_F
"numeric", #GDD_P
"numeric", #Biom_pl_g
"numeric", #yield_pl_g
"numeric", #Rust
"numeric", #Asco
"numeric" #Oidio
))
Rall_field$ENV <- as.factor(Rall_field$ENV)
Rall_field$REP <- as.factor(Rall_field$REP)
Rall_field$BLOCK <- as.factor(Rall_field$BLOCK)
Rall_field$ROW <- as.factor(Rall_field$ROW)
Rall_field$Material <- as.factor(Rall_field$Material)
Rall_field$Species <- as.factor(Rall_field$Species)
Rall_field$Structure <- as.factor(Rall_field$Structure)
Rall_field$GEN <- as.factor(Rall_field$GEN)
}
#Analysis of single environment/experiment using mixed-models
#Season 2018:
{
stat18 <- desc_stat(R18_nc, stats = "all")
gen_alphaR18 <-
gamem(R18_nc,
GEN,
REP,
resp = c("GERM", "DtF", "DtP", "GDD_F", "GDD_P", "Biom_plant_g", "yield_plant_g", "Asco", "Rust", "Oidio"),
BLOCK)
BLUP18 <- get_model_data(gen_alphaR18, what = "blupg")
#write.xlsx(BLUP18, "BLUP18.xlsx", sep = "/t")
get_model_data(gen_alphaR18)
get_model_data(gen_alphaR18, "lrt")
get_model_data(gen_alphaR18, "details")
}
#Season 2019:
{
stat19 <- desc_stat(R19_nc, stats = "all")
gen_alphaR19 <-
gamem(R19_nc,
GEN,
REP,
resp = c("GERM", "GDD_FF", "GDD_F", "GDD_FP", "GDD_P","GDD_M", "Rust", "Biom_plant_g", "yield_plant_g"),
BLOCK)
BLUP19 <- get_model_data(gen_alphaR19, what = "blupg")
#write.xlsx(BLUP19, "BLUP19.xlsx", sep = "/t")
get_model_data(gen_alphaR19)
get_model_data(gen_alphaR19, "lrt")
get_model_data(gen_alphaR19, "details")
}
#Season 2020:
{
stat20 <- desc_stat(R20_nc, stats = "all")
gen_alphaR20 <-
gamem(R20_nc,
GEN,
REP,
resp = c("GERM", "GDD_DTFF", "GDD_DTF", "GDD_DTFP", "GDD_DTP", "GDD_M", "Rust", "Asco", "Oidio", "Biom_plant_g", "yield_plant_g"),
BLOCK)
BLUP20 <- get_model_data(gen_alphaR20, what = "blupg")
get_model_data(gen_alphaR20)
get_model_data(gen_alphaR20, "lrt")
get_model_data(gen_alphaR20, "details")
}
#Growth Chamber. Controlled conditions:
{
statCC <- desc_stat(RCC_nc, stats = "all")
gen_alphaRCC <-
gamem(RCC_nc,
GEN,
REP,
resp = c("AUDPC_n", "PL50_n","DS_n", "IF_n", "IT_n"),
BLOCK)
gen_alphaRCC_noLP <-
gamem(RCC_nc,
GEN,
REP,
resp = c("AUDPC_n", "DS_n", "IF_n", "IT_n"),
BLOCK)
BLUPcc <- get_model_data(gen_alphaRCC, what = "blupg")
BLUPcc_noLP <- get_model_data(gen_alphaRCC_noLP, what = "blupg")
corr_plot(RCC_nc, c("AUDPC_n", "PL50_n", "IF_n", "DS_n", "IT_n"))
corr_plot(BLUPcc, c("AUDPC_n", "PL50_n", "IF_n", "DS_n", "IT_n"))
get_model_data(gen_alphaRCC)
get_model_data(gen_alphaRCC, "lrt")
#Genotypes Selection for rust resistance:
#FAI-BLUP:
FAI <- fai_blup(
gen_alphaRCC,
use_data = "blup",
DI = c("min", "max", "min", "min", "min"),
UI = c("max", "min", "max", "max", "max"),
SI = 15,
mineval = 1,
verbose = TRUE)
FAI_noLP <- fai_blup(
gen_alphaRCC_noLP,
use_data = "blup",
DI = c("min","min", "min", "min"),
UI = c("max", "max", "max", "max"),
SI = 15,
mineval = 1,
verbose = TRUE)
FAI_selection <- FAI$FAI
FAI_selection1 <- FAI_noLP$FAI
#write.xlsx(FAI_selection1, "FAI_selection1.xlsx", sep = "/t")
#MGIDI index selection:
mgidi_index <- mgidi(gen_alphaRCC,
ideotype = c("l", "h", "l", "l","l"),
SI = 10) # Selection intensity
mgidi_index_noLP <- mgidi(gen_alphaRCC_noLP,
ideotype = c("l", "l", "l","l"),
SI = 15) # Selection intensity
MGIDI_selection <- mgidi_index$MGIDI
#write.xlsx(MGIDI_selection, "MGIDI_selection.xlsx", sep = "/t")
MGIDI_selection1 <- mgidi_index_noLP$MGIDI
#write.xlsx(MGIDI_selection1, "MGIDI_selection1.xlsx", sep = "/t")
#Smith-Hazel index selection:
covcor1 <-  covcor_design(RCC_nc,
gen = GEN,
rep = REP ,
resp = c("AUDPC_n", "DS_n", "IF_n", "IT_n"),
design = "RCBD")
SH <- Smith_Hazel(
gen_alphaRCC,
use_data = "blup",
pcov = covcor1$phen_cov,
gcov = covcor1$geno_cov,
SI = 15,
weights = rep(5, 1)
)
SH_selection <- SH$index
#write.xlsx(SH_selection, "SH_selection.xlsx", sep = "/t")
#Comparison of the genotype selected:
coincidence <- coincidence_index(mgidi_index_noLP, FAI_noLP, SH, total = 13)
coincidence
}
#Linear model with interaction effect used to analyze data for multi-environment trials. Three seasons:
{
statFIELD <- desc_stat(Rall_field, stats = "all")
#BLUPs
mixed_mod_Rall_field <-
gamem_met(Rall_field,
ENV,
GEN,
REP,
resp = c("GERM", "GDD_F", "GDD_P", "Rust", "Biom_plant_g", "yield_plant_g"),
block = BLOCK
)
BLUP_all <- mixed_mod_Rall_field$Rust$BLUPgen
#write.xlsx(BLUP_all, "BLUP_all.xlsx", sep = "/t")
#The WAASB object
waasb_model <-
waasb(Rall_field,
env = ENV,
gen = GEN,
rep = REP,
resp = c("GERM", "GDD_F", "GDD_P", "Rust", "Biom_plant_g", "yield_plant_g"),
random = "gen", #Default
verbose = TRUE) #Default
data <- waasb_model$Rust$PCA
print(data)
data1 <- waasb_model$Rust$MeansGxE
print(data1)
WAASB_rust <- waasb_model$Rust$BLUPgen
e <- plot_waasby(waasb_model)
f <- plot_waasby(waasb_model, col.shape = c("gray20", "gray80"))
arrange_ggplot(e, f, tag_levels = list(c("e", "f")))
i <- plot_scores(waasb_model, type = 4)
j <- plot_scores(waasb_model,
type = 4,
size.tex.gen = 1.5,
color = FALSE,
col.alpha.gen = 0,
col.alpha.env = 0,
plot_theme = theme_metan(color.background = "white"))
arrange_ggplot(i, j, tag_levels = list(c("i", "j")))
details_Rall <- get_model_data(mixed_mod_Rall_field, "genpar")
get_model_data(mixed_mod_Rall_field, "lrt")
get_model_data(mixed_mod_Rall_field, "details")
get_model_data(mixed_mod_Rall_field, "estimates")
#write.xlsx(BLUPgen_all, "BLUPgen_all.xlsx", sep = "/t")
BLUPint_all <- mixed_mod_Rall_field$Rust$BLUPint
mixed_mod_Rall_field$Rust$MeansGxE
#Genotype-by-environment means
make_mat(Rall_field, GEN, ENV, Rust) %>% print(rownames = TRUE)
#Genotype-by-environment interaction effects
ge_ef <- ge_effects(Rall_field, ENV, GEN, Rust)
print(ge_ef$Rust)
plot(ge_ef)
#Genotype plus Genotype-by-environment effects
gge_ef <- ge_effects(Rall_field, ENV, GEN, Rust, type = "gge")
print(gge_ef$Rust)
GGE_rust <- gge_ef$Rust
#write.xlsx(GGE_rust, "GGE_rust.xlsx", sep = "/t")
#superiority index
super <- superiority(Rall_field, ENV, GEN, Rust)
print(super$Rust$index)
#environmental estratification
fact <- ge_factanal(Rall_field, ENV, GEN, REP, Rust)
plot(fact)
#ranking genotypes
gge_model <- gge(Rall_field, ENV, GEN, Rust)
as_tibble(gge_model$Rust$ge_mat)
#ploting
o <- plot(gge_model, type = 8)
p <- plot(gge_model,
type = 8,
col.gen = "black",
col.env = "gray",
size.text.gen = 6,
plot_theme = theme_metan_minimal())
arrange_ggplot(o, p, tag_levels = list(c("o", "p")))
residualsR18_rust <- plot(gen_alphaR18,  which = c(2,5), labels = TRUE, var = 9)
residualsR19_rust <-plot(gen_alphaR19,  which = c(2,5), labels = TRUE, var = 7)
residualsR20_rust <-plot(gen_alphaR20,  which = c(2,5), labels = TRUE, var = 7)
#Multi-trait stability index
#Lin e Binns' superiority index
out <- superiority(Rall_field, ENV, GEN, Rust)
#Annicchiarico's genotypic confidence index
Ann <- Annicchiarico(Rall_field,
env = ENV,
gen = GEN,
rep = REP,
resp = Rust)
Ann_selection <- Ann$Rust$general
#write.xlsx(Ann_selection, "Ann_selection.xlsx", sep = "/t")
}
gge_model <- gge(Rall_field, ENV, GEN, Rust)
plot(gge_model, type = 8)
plot(gge_model, type = 9, sel_gen1 = "220", sel_gen2 = "246")
plot(gge_model, type = 3)
plot(gge_model,
type = 3,
size.shape.win = 5,
large_label = 6,
col.gen = "black",
col.env = "gray",
title = FALSE)
plot(gge_model, type = 7, sel_gen = "246")
Rall_field <- #NoControls
read_excel("C:/Users/Salva/Documents/GitHub/Genomic-Selection/Genomic Selection_SALVA/data/R18_19_20.xlsx",
sheet = "R_all",
col_types =
c("text", #ENV
"text", #REP
"text", #BLOCK
"numeric", #ROW
"text", #Specie
"text", #Material
"text", #Structure
"text", #GEN
"numeric", #GERM
"numeric", #GDD_F
"numeric", #GDD_P
"numeric", #Biom_pl_g
"numeric", #yield_pl_g
"numeric", #Rust
"numeric", #Asco
"numeric" #Oidio
))
Rall_field$ENV <- as.factor(Rall_field$ENV)
Rall_field$REP <- as.factor(Rall_field$REP)
Rall_field$BLOCK <- as.factor(Rall_field$BLOCK)
Rall_field$ROW <- as.factor(Rall_field$ROW)
Rall_field$Material <- as.factor(Rall_field$Material)
Rall_field$Species <- as.factor(Rall_field$Species)
Rall_field$Structure <- as.factor(Rall_field$Structure)
Rall_field$GEN <- as.factor(Rall_field$GEN)
gge_model <- gge(Rall_field, ENV, GEN, Rust)
plot(gge_model, type = 8)
plot(gge_model, type = 9, sel_gen1 = "220", sel_gen2 = "246")
plot(gge_model,
type = 9,
sel_gen1 = "G8",
sel_gen2 = "G10",
col.gen = "black",
title = FALSE)
plot(gge_model,
type = 9,
sel_gen1 = "220",
sel_gen2 = "246",
col.gen = "black",
title = FALSE)
gge_model <- gge(Rall_field, ENV, GEN, yield_plant_g)
Rall_field <- #NoControls
read_excel("C:/Users/Salva/Documents/GitHub/Genomic-Selection/Genomic Selection_SALVA/data/R18_19_20.xlsx",
sheet = "R_all",
col_types =
c("text", #ENV
"text", #REP
"text", #BLOCK
"numeric", #ROW
"text", #Specie
"text", #Material
"text", #Structure
"text", #GEN
"numeric", #GERM
"numeric", #GDD_F
"numeric", #GDD_P
"numeric", #Biom_pl_g
"numeric", #yield_pl_g
"numeric", #Rust
"numeric", #Asco
"numeric" #Oidio
))
gge_model <- gge(Rall_field, ENV, GEN, yield_plant_g)
plot(gge_model, type = 8)
plot(gge_model,
type = 9,
sel_gen1 = "220",
sel_gen2 = "246",
col.gen = "black",
title = FALSE)
plot(gge_model, type = 7, sel_gen = "246")
plot(gge_model, type = 7, sel_gen = "326")
gge_model <- gge(Rall_field, ENV, GEN, Biom_plant_g)
plot(gge_model, type = 8)
plot(gge_model, type = 7, sel_gen = "59")
